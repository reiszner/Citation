<?xml version="1.0" encoding="utf-8" ?>
<PropertyList>

    <!--
        Manufacturer: Sperry/Honeywell / Model: MS-205
        Device: FD (flight director)
        Copyright (c) 2020 Sascha Reißner <reiszner@novaplan.at>

        This version seperates the filter for FD (flight director) and AP (autopilot)
        This makes it possible to activate the AP without FD or
        activate the FD without AP so that the pilot can be guided by the FD.

        formally known as:
        Citation II autopilot version 5.0
        Copyright (c) 2014 Ludovic Brenta <ludovic@ludovic-brenta.org>

        This program is free software; you can redistribute it and/or
        modify it under the terms of the GNU General Public License
        as published by the Free Software Foundation; either version 2
        of the License, or (at your option) any later version.

        This program is distributed in the hope that it will be useful,
        but WITHOUT ANY WARRANTY; without even the implied warranty of
        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
        GNU General Public License for more details.
    -->

<!-- FD disengage -->

    <filter>
        <name>FD disengage</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
                <not-equals>
                    <property>autopilot/mode/turn-knob</property>
                    <value>0</value>
                </not-equals>
            </condition>
        </enable>
        <input>0</input>
        <output>autopilot/ms-205[1]/mode/state</output>
    </filter>

<!-- heading course error -->

    <filter>
        <name>HDG course error</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>
        <input>
            <expression>
                <dif>
                    <property>autopilot/source/heading-bug-deg</property>
                    <property>instrumentation/heading-indicator[1]/indicated-heading-deg</property>
                </dif>
            </expression>
        </input>
        <period>
            <min>-180.0</min>
            <max> 180.0</max>
        </period>
        <output>autopilot/ms-205[1]/target/hdg-course-error</output>
    </filter>

    <filter>
        <name>BUG course error</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>
        <input>
            <condition>
                <less-than>
                    <property>autopilot/ms-205[1]/target/bug-direction</property>
                    <value>0</value>
                </less-than>
                <greater-than>
                    <property>autopilot/ms-205[1]/target/hdg-course-error</property>
                    <value>0.0</value>
                </greater-than>
            </condition>
            <expression>
                <sum>
                    <value>-360.0</value>
                    <property>autopilot/ms-205[1]/target/hdg-course-error</property>
                </sum>
            </expression>
        </input>
        <input>
            <condition>
                <greater-than>
                    <property>autopilot/ms-205[1]/target/bug-direction</property>
                    <value>0</value>
                </greater-than>
                <less-than>
                    <property>autopilot/ms-205[1]/target/hdg-course-error</property>
                    <value>0.0</value>
                </less-than>
            </condition>
            <expression>
                <sum>
                    <value>360.0</value>
                    <property>autopilot/ms-205[1]/target/hdg-course-error</property>
                </sum>
            </expression>
        </input>
        <input>autopilot/ms-205[1]/target/hdg-course-error</input>
        <output>autopilot/ms-205[1]/target/bug-course-error</output>
    </filter>

    <filter>
        <name>BUG direction</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>
        <input>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                    <value>1</value>
                </equals>
                <less-than>
                    <property>autopilot/ms-205[1]/target/bug-course-error</property>
                    <value>-90.0</value>
                </less-than>
            </condition>
            <value>-1</value>
        </input>
        <input>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                    <value>1</value>
                </equals>
                <greater-than>
                    <property>autopilot/ms-205[1]/target/bug-course-error</property>
                    <value>90.0</value>
                </greater-than>
            </condition>
            <value>1</value>
        </input>
        <input>0</input>
        <output>autopilot/ms-205[1]/target/bug-direction</output>
    </filter>

<!-- NAV/LOC course error -->

    <filter>
        <name>NAV/LOC course error</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>
        <input>
            <condition>
                <property>instrumentation/nav-selector[1]/nav-loc</property>
                <or>
                    <equals>
                        <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                        <value>4</value>
                    </equals>
                    <equals>
                        <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                        <value>4</value>
                    </equals>
                </or>
            </condition>
            <expression>
                <dif>
                    <sum>
                        <property>instrumentation/nav-selector[1]/target-radial-deg</property>
                        <value>180</value>
                    </sum>
                    <property>instrumentation/heading-indicator[1]/indicated-heading-deg</property>
                    <property>environment/magnetic-variation-deg</property>
                </dif>
            </expression>
        </input>
        <input>
            <condition>
                <property>instrumentation/nav-selector[1]/nav-loc</property>
            </condition>
            <expression>
                <dif>
                    <property>instrumentation/nav-selector[1]/target-radial-deg</property>
                    <property>instrumentation/heading-indicator[1]/indicated-heading-deg</property>
                    <property>environment/magnetic-variation-deg</property>
                </dif>
            </expression>
        </input>
        <input>
            <expression>
                <sum>
                    <dif>
                        <property>instrumentation/nav-selector[1]/selected-radial-deg</property>
                        <property>instrumentation/heading-indicator[1]/indicated-heading-deg</property>
                    </dif>
                    <dif>
                        <property>instrumentation/nav-selector[1]/selected-radial-deg</property>
                        <property>instrumentation/nav-selector[1]/target-radial-deg</property>
                    </dif>
                </sum>
            </expression>
        </input>
        <period>
            <min>-180.0</min>
            <max> 180.0</max>
        </period>
        <output>autopilot/ms-205[1]/target/nav-course-error</output>
    </filter>

    <filter>
        <name>nav-deflection</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>
        <input>
            <condition>
                <property>instrumentation/nav-selector[1]/nav-loc</property>
            </condition>
            <expression>
                <product>
                    <property>instrumentation/nav-selector[1]/loc-deflection</property>
                    <value>0.2</value>
                </product>
            </expression>
        </input>
        <input>
            <property>instrumentation/nav-selector[1]/vor-deflection</property>
        </input>
        <output>autopilot/ms-205[1]/gain/nav-deflection</output>
    </filter>

<!-- target updates -->

    <filter>
        <name>holding-pitch</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <or>
                    <not-equals>
                        <property>autopilot/ms-205[1]/mode/state</property>
                        <value>1</value>
                    </not-equals>
                    <not-equals>
                        <property>autopilot/ms-205[1]/mode/vertical-mode</property>
                        <value>0</value>
                    </not-equals>
                    <property>autopilot/mode/cws</property>
                </or>
            </condition>
        </enable>
        <input>
            <expression>
                <product>
                    <floor>
                        <sum>
                            <product>
                                <property>autopilot/source/airdata/pitch-deg</property>
                                <value>10.0</value>
                            </product>
                            <value>0.5</value>
                        </sum>
                    </floor>
                    <value>0.1</value>
                </product>
            </expression>
        </input>
        <output>autopilot/ms-205[1]/target/pitch-deg</output>
    </filter>

    <filter>
        <name>altitude</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <or>
                    <not-equals>
                        <property>autopilot/ms-205[1]/mode/state</property>
                        <value>1</value>
                    </not-equals>
                    <not-equals>
                        <property>autopilot/ms-205[1]/mode/vertical-mode</property>
                        <value>1</value>
                    </not-equals>
                    <property>autopilot/mode/cws</property>
                </or>
            </condition>
        </enable>
        <input>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/vertical-mode</property>
                    <value>2</value>
                </equals>
            </condition>
            <property>autopilot/ms-205[1]/target/altitude-ft-preset</property>
        </input>
        <input>autopilot/source/airdata/altitude-ft</input>
        <output>autopilot/ms-205[1]/target/altitude-ft</output>
    </filter>

    <filter>
        <name>altitude-error</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>
        <input>
            <expression>
                <dif>
                    <property>autopilot/ms-205[1]/target/altitude-ft</property>
                    <property>autopilot/source/airdata/altitude-ft</property>
                </dif>
            </expression>
        </input>
        <output>autopilot/ms-205[1]/target/altitude-ft-error</output>
    </filter>

    <filter>
        <name>altitude-preset</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
                <or>
                    <and>
                        <equals>
                            <property>autopilot/ms-205[1]/mode/vertical-arm</property>
                            <value>2</value>
                        </equals>
                        <not-equals>
                            <property>autopilot/ms-205[1]/mode/vertical-mode</property>
                            <value>3</value>
                        </not-equals>
                    </and>
                    <equals>
                        <property>autopilot/ms-205[1]/mode/vertical-arm</property>
                        <value>3</value>
                    </equals>
                </or>
            </condition>
        </enable>
        <input>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/vertical-arm</property>
                    <value>2</value>
                </equals>
                <not-equals>
                    <property>autopilot/ms-205[1]/mode/vertical-mode</property>
                    <value>3</value>
                </not-equals>
            </condition>
            <property>autopilot/vn-212/altitude-select</property>
        </input>
        <input>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/vertical-arm</property>
                    <value>3</value>
                </equals>
            </condition>
            <property>autopilot/vn-212/station-elevation-ft</property>
        </input>
        <output>autopilot/ms-205[1]/target/altitude-ft-preset</output>
    </filter>

    <filter>
        <name>altitude-preset-error</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>
        <input>
            <expression>
                <dif>
                    <property>autopilot/ms-205[1]/target/altitude-ft-preset</property>
                    <property>autopilot/source/airdata/altitude-ft</property>
                </dif>
            </expression>
        </input>
        <output>autopilot/ms-205[1]/target/altitude-ft-preset-error</output>
    </filter>

    <filter>
        <name>vnav-path</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
                <or>
                    <equals>
                        <property>autopilot/ms-205[1]/mode/vertical-mode</property>
                        <value>3</value>
                    </equals>
                    <equals>
                        <property>autopilot/ms-205[1]/mode/vertical-arm</property>
                        <value>3</value>
                    </equals>
                </or>
            </condition>
        </enable>
        <input>autopilot/vn-212/vertical-angle-deg</input>
        <output>autopilot/ms-205[1]/target/path-deg</output>
    </filter>

    <filter>
        <name>gs-path</name>
        <type>gain</type>
        <gain>-1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
                <or>
                    <equals>
                        <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                        <value>3</value>
                    </equals>
                    <equals>
                        <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                        <value>3</value>
                    </equals>
                </or>
            </condition>
        </enable>

        <input>
            <expression>
                <sum>
                    <property>instrumentation/nav-selector[1]/gs-direct-deg</property>
                    <property>instrumentation/nav-selector[1]/gs-needle-deflection-deg</property>
                </sum>
            </expression>
        </input>

        <output>autopilot/ms-205[1]/target/gs-deg</output>
    </filter>

    <filter>
        <name>path-error</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>

        <input>
            <condition>
                <or>
                    <greater-than>
                        <property>autopilot/ms-205[1]/target/path-deg</property>
                        <value>-20.0</value>
                    </greater-than>
                    <equals>
                        <property>autopilot/ms-205[1]/mode/vertical-mode</property>
                        <value>3</value>
                    </equals>
                    <equals>
                        <property>autopilot/ms-205[1]/mode/vertical-arm</property>
                        <value>3</value>
                    </equals>
                </or>
            </condition>
            <expression>
                <dif>
                    <property>autopilot/ms-205[1]/target/path-deg</property>
                    <property>autopilot/source/airdata/path-deg</property>
                </dif>
            </expression>
        </input>

        <input>
            <condition>
                <or>
                    <equals>
                        <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                        <value>3</value>
                    </equals>
                    <equals>
                        <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                        <value>3</value>
                    </equals>
                </or>
            </condition>
            <expression>
                <dif>
                    <property>autopilot/ms-205[1]/target/gs-deg</property>
                    <property>autopilot/source/airdata/path-deg</property>
                </dif>
            </expression>
        </input>

        <input>0.0</input>
        <output>autopilot/ms-205[1]/target/path-deg-error</output>
    </filter>

    <filter>
        <name>vs-fpm</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <or>
                    <not-equals>
                        <property>autopilot/ms-205[1]/mode/state</property>
                        <value>1</value>
                    </not-equals>
                    <not-equals>
                        <property>autopilot/ms-205[1]/mode/vertical-mode</property>
                        <value>4</value>
                    </not-equals>
                    <property>autopilot/mode/cws</property>
                </or>
            </condition>
        </enable>
        <input>
            <expression>
                <product>
                    <floor>
                        <sum>
                            <product>
                                <property>autopilot/source/airdata/vs-fpm</property>
                                <value>0.01</value>
                            </product>
                            <value>0.5</value>
                        </sum>
                    </floor>
                    <value>100.0</value>
                </product>
            </expression>
        </input>
        <output>autopilot/ms-205[1]/target/vs-fpm</output>
    </filter>

    <filter>
        <name>speed-kt</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <input>instrumentation/airspeed-indicator[1]/index-marker</input>
        <output>autopilot/ms-205[1]/target/speed-kt</output>
    </filter>

<!-- distance gain -->

    <filter>
        <name>distance-gain</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
                <property>instrumentation/nav-selector[1]/signal-valid</property>
            </condition>
        </enable>
        <input>
            <expression>
                <sum>
                    <div>
                        <div>
                            <property>instrumentation/nav-selector[1]/nav-distance</property>
                            <value>1852.0</value>
                        </div>
                        <value>30.0</value>
                    </div>
                    <value>0.5</value>
                </sum>
            </expression>
        </input>
        <output>autopilot/ms-205[1]/gain/distance-gain</output>
        <min>0.3</min>
        <max>10.0</max>
    </filter>

<!-- turn time -->

    <filter>
        <name>turn time</name>
        <type>gain</type>
        <!-- factor for standard turn (90° need 30sec) -->
        <gain>19.098593171</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>
        <input>
            <condition>
                <or>
                    <equals>
                        <property>autopilot/ms-205[1]/target/nav-course-error</property>
                        <value>90.0</value>
                    </equals>
                    <equals>
                        <property>autopilot/ms-205[1]/target/nav-course-error</property>
                        <value>-90.0</value>
                    </equals>
                </or>
            </condition>
            <!-- TODO: factor for wider radius -->
            <value>1.0</value>
        </input>
        <input>
            <condition>
                <or>
                    <greater-than>
                        <property>autopilot/ms-205[1]/target/nav-course-error</property>
                        <value>90.0</value>
                    </greater-than>
                    <less-than>
                        <property>autopilot/ms-205[1]/target/nav-course-error</property>
                        <value>-90.0</value>
                    </less-than>
                </or>
            </condition>
            <expression>
                <product>
                    <sum>
                        <value>1.0</value>
                        <abs>
                            <cos>
                                <deg2rad><property>autopilot/ms-205[1]/target/nav-course-error</property></deg2rad>
                            </cos>
                        </abs>
                    </sum>
                    <div>
                        <value>1.0</value>
                        <abs>
                            <sin>
                                <deg2rad><property>autopilot/ms-205[1]/target/nav-course-error</property></deg2rad>
                            </sin>
                        </abs>
                    </div>
                    <!-- TODO: factor for wider radius -->
                    <value>1.0</value>
                </product>
            </expression>
        </input>
        <input>
            <expression>
                <product>
                    <dif>
                        <value>1.0</value>
                        <abs>
                            <cos>
                                <deg2rad><property>autopilot/ms-205[1]/target/nav-course-error</property></deg2rad>
                            </cos>
                        </abs>
                    </dif>
                    <div>
                        <value>1.0</value>
                        <abs>
                            <sin>
                                <deg2rad><property>autopilot/ms-205[1]/target/nav-course-error</property></deg2rad>
                            </sin>
                        </abs>
                    </div>
                    <!-- TODO: factor for wider radius -->
                    <value>1.0</value>
                </product>
            </expression>
        </input>
        <output>autopilot/ms-205[1]/gain/turn-time-sec</output>
        <min>10</min>
        <max>300</max>
    </filter>

<!-- deflection predict -->
    <filter>
        <name>deflection-predict-time</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>
        <input>
            <expression>
                <sum>
                    <property>autopilot/ms-205[1]/gain/turn-time-sec</property>
                    <value>6</value>
                </sum>
            </expression>
        </input>
        <output>autopilot/ms-205[1]/gain/deflection-predict-time</output>
    </filter>

    <predict-simple>
        <name>deflection predict</name>
        <debug>false</debug>
        <seconds>autopilot/ms-205[1]/gain/deflection-predict-time</seconds>
        <filter-gain>1</filter-gain>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>
        <input>autopilot/ms-205[1]/gain/nav-deflection</input>
        <output>autopilot/ms-205[1]/gain/deflection-predict</output>
    </predict-simple>

<!-- nav-turn-gain -->
    <filter>
        <name>nav-turn-gain</name>
        <type>gain</type>
        <gain>instrumentation/nav-selector[0]/coc-signal</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>

<!-- back course -->
        <input>
            <condition>
                <or>
                    <equals>
                        <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                        <value>4</value>
                    </equals>
                    <equals>
                        <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                        <value>4</value>
                    </equals>
                </or>
            </condition>
            <expression>
                <product>
                    <property>autopilot/ms-205[1]/gain/deflection-predict</property>
                    <property>autopilot/ms-205[1]/gain/distance-gain</property>
                    <value>-1</value>
                </product>
            </expression>
        </input>

<!-- nav / approach -->
        <input>
            <expression>
                <product>
                    <property>autopilot/ms-205[1]/gain/deflection-predict</property>
                    <property>autopilot/ms-205[1]/gain/distance-gain</property>
                </product>
            </expression>
        </input>

        <min>-1.0</min>
        <max> 1.0</max>
        <output>autopilot/ms-205[1]/gain/nav-turn-gain</output>
    </filter>

<!-- turn left is not allowed if we should turn right to intercept -->
    <filter>
        <name>nav-turn-lock-left</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
                <less-than>
                    <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                    <value>2</value>
                </less-than>
                <greater-than>
                    <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                    <value>1</value>
                </greater-than>
            </condition>
        </enable>
        <input>
            <condition>
                <greater-than>
                    <property>autopilot/ms-205[1]/target/nav-course-error</property>
                    <value>0.0</value>
                </greater-than>
                <less-than>
                    <property>autopilot/ms-205[1]/gain/nav-deflection</property>
                    <value>0.0</value>
                </less-than>
            </condition>
            <value>0</value>
        </input>
        <input>1</input>
        <output>autopilot/ms-205[1]/gain/nav-turn-lock-left</output>
    </filter>

<!-- turn left is allowed if we allready turned right -->
    <filter>
        <name>nav-turn-lock-left</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
                <greater-than>
                    <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                    <value>1</value>
                </greater-than>
                <not><property>autopilot/ms-205[1]/gain/nav-turn-lock-left</property></not>
                <greater-than>
                    <property>autopilot/ms-205[1]/gain/nav-turn</property>
                    <value>0.05</value>
                </greater-than>
            </condition>
        </enable>
        <input>1</input>
        <output>autopilot/ms-205[1]/gain/nav-turn-lock-left</output>
    </filter>

<!-- turn left up to 45° intercept angle -->
    <filter>
        <name>nav-turn-gain-left</name>
        <type>gain</type>
        <gain>autopilot/ms-205[1]/gain/nav-turn-lock-left</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>
        <input>
            <condition>
                <greater-than>
                    <property>autopilot/ms-205[1]/target/nav-course-error</property>
                    <value>45.0</value>
                </greater-than>
            </condition>
            <value>0.0</value>
        </input>
        <input>
            <expression>
                <abs>
                    <div>
                        <sum>
                            <property>autopilot/ms-205[1]/target/nav-course-error</property>
                            <value>-45</value>
                        </sum>
                        <value>45</value>
                    </div>
                </abs>
            </expression>
        </input>
        <min>0.0</min>
        <max>1.0</max>
        <output>autopilot/ms-205[1]/gain/nav-turn-gain-left</output>
    </filter>

<!-- turn right is not allowed if we should turn left to intercept -->
    <filter>
        <name>nav-turn-lock-right</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
                <less-than>
                    <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                    <value>2</value>
                </less-than>
                <greater-than>
                    <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                    <value>1</value>
                </greater-than>
            </condition>
        </enable>
        <input>
            <condition>
                <less-than>
                    <property>autopilot/ms-205[1]/target/nav-course-error</property>
                    <value>0.0</value>
                </less-than>
                <greater-than>
                    <property>autopilot/ms-205[1]/gain/nav-deflection</property>
                    <value>0.0</value>
                </greater-than>
            </condition>
            <value>0</value>
        </input>
        <input>1</input>
        <output>autopilot/ms-205[1]/gain/nav-turn-lock-right</output>
    </filter>

<!-- turn right is allowed if we allready turned left -->
    <filter>
        <name>nav-turn-lock-right</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
                <greater-than>
                    <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                    <value>1</value>
                </greater-than>
                <not><property>autopilot/ms-205[1]/gain/nav-turn-lock-right</property></not>
                <less-than>
                    <property>autopilot/ms-205[1]/gain/nav-turn</property>
                    <value>-0.05</value>
                </less-than>
            </condition>
        </enable>
        <input>1</input>
        <output>autopilot/ms-205[1]/gain/nav-turn-lock-right</output>
    </filter>

<!-- turn right up to 45° intercept angle -->
    <filter>
        <name>nav-turn-gain-right</name>
        <type>gain</type>
        <gain>autopilot/ms-205[1]/gain/nav-turn-lock-right</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>
        <input>
            <condition>
                <less-than>
                    <property>autopilot/ms-205[1]/target/nav-course-error</property>
                    <value>-45.0</value>
                </less-than>
            </condition>
            <value>0.0</value>
        </input>
        <input>
            <expression>
                <abs>
                    <div>
                        <sum>
                            <property>autopilot/ms-205[1]/target/nav-course-error</property>
                            <value>45</value>
                        </sum>
                        <value>45</value>
                    </div>
                </abs>
            </expression>
        </input>
        <min>0.0</min>
        <max>1.0</max>
        <output>autopilot/ms-205[1]/gain/nav-turn-gain-right</output>
    </filter>

<!-- nav-turn -->

    <filter>
        <name>nav-turn</name>
        <type>gain</type>
        <gain>1.0</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>

        <input>
            <condition>
                <less-than>
                    <property>autopilot/ms-205[1]/gain/nav-turn-gain</property>
                    <value>0.0</value>
                </less-than>
            </condition>
            <expression>
                <product>
                    <sin>
                        <product>
                            <property>autopilot/ms-205[1]/gain/nav-turn-gain</property>
                            <value>1.5707963268</value>
                        </product>
                    </sin>
                    <property>autopilot/ms-205[1]/gain/nav-turn-gain-left</property>
                </product>
            </expression>
        </input>

        <input>
            <expression>
                <product>
                    <sin>
                        <product>
                            <property>autopilot/ms-205[1]/gain/nav-turn-gain</property>
                            <value>1.5707963268</value>
                        </product>
                    </sin>
                    <property>autopilot/ms-205[1]/gain/nav-turn-gain-right</property>
                </product>
            </expression>
        </input>

        <min>-1.0</min>
        <max> 1.0</max>
        <output>autopilot/ms-205[1]/gain/nav-turn</output>
    </filter>

<!-- GS deflection predict -->

    <predict-simple>
        <name>deflection predict</name>
        <debug>false</debug>
        <seconds>10.0</seconds>
        <filter-gain>1</filter-gain>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>
        <input>
            <condition>
                <property>instrumentation/nav-selector[1]/gs-valid</property>
            </condition>
            <property>instrumentation/nav-selector[1]/gs-deflection</property>
        </input>
        <input>999.9</input>
        <output>autopilot/ms-205[1]/gain/gs-deflection-predict</output>
    </predict-simple>

<!-- ias predict -->

    <predict-simple>
        <name>ias predict</name>
        <debug>false</debug>
        <seconds>10.0</seconds>
        <filter-gain>1.0</filter-gain>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>
        <input>autopilot/source/airdata/ias-kt</input>
        <output>autopilot/ms-205[1]/gain/ias-predict</output>
    </predict-simple>

    <filter>
        <name>ias error</name>
        <type>gain</type>
        <gain>0.1</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>
        <input>
            <expression>
                <dif>
                    <property>autopilot/ms-205[1]/gain/ias-predict</property>
                    <property>autopilot/ms-205[1]/target/speed-kt</property>
                </dif>
            </expression>
        </input>
        <output>autopilot/ms-205[1]/gain/ias-error</output>
    </filter>

<!-- pitch predict -->

    <filter>
        <name>pitch error</name>
        <type>gain</type>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>
        <input>
            <expression>
                <abs><property>autopilot/source/airdata/pitch-deg</property></abs>
            </expression>
        </input>
        <output>autopilot/ms-205[1]/gain/pitch-error</output>
    </filter>

    <predict-simple>
        <name>pitch predict</name>
        <debug>false</debug>
        <seconds>autopilot/ms-205[1]/gain/pitch-error</seconds>
        <filter-gain>0.2</filter-gain>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>
        <input>autopilot/source/airdata/altitude-ft</input>
        <output>autopilot/ms-205[1]/gain/pitch-predict</output>
    </predict-simple>

<!-- mode switching of mode selector (Sperry MS-205) -->

    <filter>
        <name>power off</name>
        <debug>false</debug>
        <type>gain</type>
        <enable>
            <condition>
                <less-than>
                    <property>systems/electrical/outputs/main-right/dc-fd2</property>
                    <value>18</value>
                </less-than>
                <greater-than>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>-1</value>
                </greater-than>
            </condition>
        </enable>
        <input>-1</input>
        <output>autopilot/ms-205[1]/mode/state</output>
    </filter>

    <filter>
        <name>power on</name>
        <debug>false</debug>
        <type>gain</type>
        <enable>
            <condition>
                <greater-than>
                    <property>systems/electrical/outputs/main-right/dc-fd2</property>
                    <value>18</value>
                </greater-than>
                <less-than>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>0</value>
                </less-than>
            </condition>
        </enable>
        <input>0</input>
        <output>autopilot/ms-205[1]/mode/state</output>
    </filter>

    <filter>
        <name>clear modes</name>
        <debug>false</debug>
        <type>gain</type>
        <enable>
            <condition>
                <less-than>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </less-than>
            </condition>
        </enable>
        <input>0</input>
        <output>autopilot/ms-205[1]/mode/lateral-arm</output>
        <output>autopilot/ms-205[1]/mode/lateral-mode</output>
        <output>autopilot/ms-205[1]/mode/vertical-arm</output>
        <output>autopilot/ms-205[1]/mode/vertical-mode</output>
    </filter>

    <filter>
        <name>panel test</name>
        <debug>false</debug>
        <type>gain</type>
        <enable>
            <condition>
                <greater-than>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </greater-than>
                <less-than>
                    <property>autopilot/ms-205[1]/panel/off</property>
                    <value>1</value>
                </less-than>
            </condition>
        </enable>
        <input>0</input>
        <output>autopilot/ms-205[1]/mode/state</output>
    </filter>

<!-- lateral modes -->

    <filter>
        <name>nav cap</name>
        <type>gain</type>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                    <value>2</value>
                </equals>
                <property>instrumentation/nav-selector[1]/signal-valid</property>
                <less-than>
                    <property>instrumentation/nav-selector[1]/vor-deflection</property>
                    <value>2.0</value>
                </less-than>
                <greater-than>
                    <property>instrumentation/nav-selector[1]/vor-deflection</property>
                    <value>-2.0</value>
                </greater-than>
            </condition>
        </enable>
        <input>-2</input>
        <output>autopilot/ms-205[1]/mode/lateral-arm</output>
    </filter>

    <filter>
        <name>nav mode</name>
        <type>gain</type>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                    <value>-2</value>
                </equals>
            </condition>
        </enable>
        <input>2</input>
        <output>autopilot/ms-205[1]/mode/lateral-mode</output>
    </filter>

    <filter>
        <name>nav arm cancel</name>
        <type>gain</type>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                    <value>-2</value>
                </equals>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                    <value>2</value>
                </equals>
            </condition>
        </enable>
        <input>0</input>
        <output>autopilot/ms-205[1]/mode/lateral-arm</output>
    </filter>

    <filter>
        <name>apr nav cap</name>
        <type>gain</type>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                    <value>3</value>
                </equals>
                <not-equals>
                    <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                    <value>2</value>
                </not-equals>
                <property>instrumentation/nav-selector[1]/loc-valid</property>
                <less-than>
                    <property>instrumentation/nav-selector[1]/loc-deflection</property>
                    <value>4.0</value>
                </less-than>
                <greater-than>
                    <property>instrumentation/nav-selector[1]/loc-deflection</property>
                    <value>-4.0</value>
                </greater-than>
            </condition>
        </enable>
        <input>2</input>
        <output>autopilot/ms-205[1]/mode/lateral-mode</output>
    </filter>

    <filter>
        <name>apr cap</name>
        <type>gain</type>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                    <value>3</value>
                </equals>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                    <value>2</value>
                </equals>
                <property>instrumentation/nav-selector[1]/loc-valid</property>
                <property>instrumentation/nav-selector[1]/gs-valid</property>
                <less-than>
                    <property>instrumentation/nav-selector[1]/gs-deflection</property>
                    <value>0.4</value>
                </less-than>
                <greater-than>
                    <property>instrumentation/nav-selector[1]/gs-deflection</property>
                    <value>-0.4</value>
                </greater-than>
            </condition>
        </enable>
        <input>-3</input>
        <output>autopilot/ms-205[1]/mode/lateral-arm</output>
    </filter>

    <filter>
        <name>apr mode</name>
        <type>gain</type>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                    <value>-3</value>
                </equals>
            </condition>
        </enable>
        <input>3</input>
        <output>autopilot/ms-205[1]/mode/lateral-mode</output>
    </filter>

    <filter>
        <name>apr arm cancel</name>
        <type>gain</type>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                    <value>-3</value>
                </equals>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                    <value>3</value>
                </equals>
            </condition>
        </enable>
        <input>0</input>
        <output>autopilot/ms-205[1]/mode/lateral-arm</output>
    </filter>

    <filter>
        <name>bc cap</name>
        <type>gain</type>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                    <value>4</value>
                </equals>
                <property>instrumentation/nav-selector[1]/loc-valid</property>
                <less-than>
                    <property>instrumentation/nav-selector[1]/loc-deflection</property>
                    <value>4.0</value>
                </less-than>
                <greater-than>
                    <property>instrumentation/nav-selector[1]/loc-deflection</property>
                    <value>-4.0</value>
                </greater-than>
            </condition>
        </enable>
        <input>-4</input>
        <output>autopilot/ms-205[1]/mode/lateral-arm</output>
    </filter>

    <filter>
        <name>bc mode</name>
        <type>gain</type>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                    <value>-4</value>
                </equals>
            </condition>
        </enable>
        <input>4</input>
        <output>autopilot/ms-205[1]/mode/lateral-mode</output>
    </filter>

    <filter>
        <name>bc arm cancel</name>
        <type>gain</type>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                    <value>-4</value>
                </equals>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                    <value>4</value>
                </equals>
            </condition>
        </enable>
        <input>0</input>
        <output>autopilot/ms-205[1]/mode/lateral-arm</output>
    </filter>

<!-- vertical modes -->

    <filter>
        <name>alt hold</name>
        <type>gain</type>
        <debug>false</debug>
        <enable>
            <condition>
                <greater-than>
                    <property>autopilot/ms-205[1]/mode/vertical-mode</property>
                    <value>0</value>
                </greater-than>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                    <value>3</value>
                </equals>
            </condition>
        </enable>
        <input>0</input>
        <output>autopilot/ms-205[1]/mode/vertical-mode</output>
    </filter>

    <filter>
        <name>alt hold</name>
        <type>gain</type>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/vertical-mode</property>
                    <value>2</value>
                </equals>
                <less-than>
                    <property>autopilot/ms-205[1]/target/altitude-ft-error</property>
                    <value>20.0</value>
                </less-than>
                <greater-than>
                    <property>autopilot/ms-205[1]/target/altitude-ft-error</property>
                    <value>-20.0</value>
                </greater-than>
            </condition>
        </enable>
        <input>1</input>
        <output>autopilot/ms-205[1]/mode/vertical-mode</output>
    </filter>

    <filter>
        <name>altsel cap</name>
        <type>gain</type>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/vertical-arm</property>
                    <value>2</value>
                </equals>
                <not-equals>
                    <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                    <value>3</value>
                </not-equals>
                <not-equals>
                    <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                    <value>3</value>
                </not-equals>
                <less-than>
                    <property>autopilot/ms-205[1]/target/altitude-ft-preset-error</property>
                    <value>200.0</value>
                </less-than>
                <greater-than>
                    <property>autopilot/ms-205[1]/target/altitude-ft-preset-error</property>
                    <value>-200.0</value>
                </greater-than>
            </condition>
        </enable>
        <input>-2</input>
        <output>autopilot/ms-205[1]/mode/vertical-arm</output>
    </filter>

    <filter>
        <name>altsel mode</name>
        <type>gain</type>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/vertical-arm</property>
                    <value>-2</value>
                </equals>
            </condition>
        </enable>
        <input>2</input>
        <output>autopilot/ms-205[1]/mode/vertical-mode</output>
    </filter>

    <filter>
        <name>altsel arm cancel</name>
        <type>gain</type>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/vertical-arm</property>
                    <value>-2</value>
                </equals>
                <equals>
                    <property>autopilot/ms-205[1]/mode/vertical-mode</property>
                    <value>2</value>
                </equals>
            </condition>
        </enable>
        <input>0</input>
        <output>autopilot/ms-205[1]/mode/vertical-arm</output>
    </filter>

    <filter>
        <name>vnav cap</name>
        <type>gain</type>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/vertical-arm</property>
                    <value>3</value>
                </equals>
                <not-equals>
                    <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                    <value>4</value>
                </not-equals>
                <not-equals>
                    <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                    <value>4</value>
                </not-equals>
                <less-than>
                    <property>autopilot/ms-205[1]/target/path-deg-error</property>
                    <value>0.1</value>
                </less-than>
                <greater-than>
                    <property>autopilot/ms-205[1]/target/path-deg-error</property>
                    <value>-0.1</value>
                </greater-than>
            </condition>
        </enable>
        <input>3</input>
        <output>autopilot/ms-205[1]/mode/vertical-mode</output>
    </filter>

    <filter>
        <name>vnav arm cancel</name>
        <type>gain</type>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/vertical-arm</property>
                    <value>3</value>
                </equals>
                <equals>
                    <property>autopilot/ms-205[1]/mode/vertical-mode</property>
                    <value>3</value>
                </equals>
            </condition>
        </enable>
        <input>2</input>
        <output>autopilot/ms-205[1]/mode/vertical-arm</output>
    </filter>

<!-- mode catcher -->

    <filter>
        <name>catch-altsel</name>
        <debug>false</debug>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>
        <input>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/vertical-arm</property>
                    <value>2</value>
                </equals>
                <not-equals>
                    <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                    <value>3</value>
                </not-equals>
                <or>
                    <property>autopilot/ms-205[1]/target/catch-altsel</property>
                    <and>
                        <greater-than>
                            <property>autopilot/ms-205[1]/target/altitude-ft-preset</property>
                            <property>autopilot/source/airdata/altitude-ft</property>
                        </greater-than>
                        <greater-than>
                            <property>autopilot/ms-205[1]/gain/pitch-predict</property>
                            <property>autopilot/ms-205[1]/target/altitude-ft-preset</property>
                        </greater-than>
                    </and>
                    <and>
                        <less-than>
                            <property>autopilot/ms-205[1]/target/altitude-ft-preset</property>
                            <property>autopilot/source/airdata/altitude-ft</property>
                        </less-than>
                        <less-than>
                            <property>autopilot/ms-205[1]/gain/pitch-predict</property>
                            <property>autopilot/ms-205[1]/target/altitude-ft-preset</property>
                        </less-than>
                    </and>
                </or>
            </condition>
            <value>1</value>
        </input>
        <input>0</input>
        <output>autopilot/ms-205[1]/target/catch-altsel</output>
    </filter>

<!-- =============================== -->
<!-- ======= Lateral Modes ========= -->
<!-- =============================== -->

    <filter>
        <name>FD: set target roll</name>
        <type>gain</type>
        <debug>false</debug>
        <enable>
            <condition>
                <equals> 
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>

<!-- NAV mode -->
        <input>
            <condition>
                <or>
                    <greater-than>
                        <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                        <value>1</value>
                    </greater-than>
                    <and>
                        <greater-than>
                            <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                            <value>1</value>
                        </greater-than>
                        <greater-than>
                            <property>instrumentation/nav-selector[1]/vor-deflection</property>
                            <value>0.0</value>
                        </greater-than>
                        <less-than>
                            <property>autopilot/ms-205[1]/gain/deflection-predict</property>
                            <value>0.0</value>
                        </less-than>
                    </and>
                    <and>
                        <greater-than>
                            <property>autopilot/ms-205[1]/mode/lateral-arm</property>
                            <value>1</value>
                        </greater-than>
                        <less-than>
                            <property>instrumentation/nav-selector[1]/vor-deflection</property>
                            <value>0.0</value>
                        </less-than>
                        <greater-than>
                            <property>autopilot/ms-205[1]/gain/deflection-predict</property>
                            <value>0.0</value>
                        </greater-than>
                    </and>
                </or>
            </condition>
            <expression>
                <sin>
                    <product>
                        <property>autopilot/ms-205[1]/gain/nav-turn</property>
                        <value>1.5707963268</value>
                    </product>
                </sin>
            </expression>
        </input>

<!-- ROL mode -->
        <input>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                    <value>0</value>
                </equals>
            </condition>
            <value>0.0</value>
        </input>

<!-- HDG mode -->
        <input>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                    <value>1</value>
                </equals>
                <or>
                    <less-than>
                        <property>autopilot/ms-205[1]/target/bug-course-error</property>
                        <value>-45.0</value>
                    </less-than>
                    <greater-than>
                        <property>autopilot/ms-205[1]/target/bug-course-error</property>
                        <value>45.0</value>
                    </greater-than>
                </or>
            </condition>
            <property>autopilot/ms-205[1]/target/bug-course-error</property>
        </input>
        <input>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                    <value>1</value>
                </equals>
            </condition>
            <expression>
                <sin>
                    <deg2rad>
                        <product>
                            <property>autopilot/ms-205[1]/target/bug-course-error</property>
                            <value>2.0</value>
                        </product>
                    </deg2rad>
                </sin>
            </expression>
        </input>

        <output>autopilot/ms-205[1]/command/roll-deg</output>
        <min>-1.0</min>
        <max> 1.0</max>
    </filter>

<!-- ================================ -->
<!-- ======= Vertical Modes ========= -->
<!-- ================================ -->

    <filter>
        <name>FD: set target pitch rate deg/s</name>
        <type>gain</type>
        <gain>1</gain>
        <debug>false</debug>
        <enable>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/state</property>
                    <value>1</value>
                </equals>
            </condition>
        </enable>

<!-- gs hold -->
        <input>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/lateral-mode</property>
                    <value>3</value>
                </equals>
            </condition>
            <property>autopilot/ms-205[1]/gain/gs-deflection-predict</property>
            <min>
                <expression>
                    <dif>
                        <value>-20</value>
                        <property>autopilot/source/airdata/pitch-deg</property>
                    </dif>
                </expression>
            </min>
            <max>
                <expression>
                    <dif>
                        <value>20</value>
                        <property>autopilot/source/airdata/pitch-deg</property>
                    </dif>
                </expression>
            </max>
        </input>

<!-- alt sel -->
        <input>
            <condition>
                <or>
                    <equals>
                        <property>autopilot/ms-205[1]/mode/vertical-mode</property>
                        <value>2</value>
                    </equals>
                    <property>autopilot/ms-205[1]/target/catch-altsel</property>
                </or>
            </condition>
            <expression>
                <product>
                    <sum>
                        <property>autopilot/ms-205[1]/target/altitude-ft-preset-error</property>
                        <product>
                            <property>autopilot/source/airdata/vs-fpm</property>
                            <value>-0.3</value>
                        </product>
                    </sum>
                    <value>0.002</value>
                </product>
            </expression>
            <min>
                <expression>
                    <dif>
                        <value>-20</value>
                        <property>autopilot/source/airdata/pitch-deg</property>
                    </dif>
                </expression>
            </min>
            <max>
                <expression>
                    <dif>
                        <value>20</value>
                        <property>autopilot/source/airdata/pitch-deg</property>
                    </dif>
                </expression>
            </max>
        </input>

<!-- vnav hold -->
        <input>
            <condition>
                <or>
                    <equals>
                        <property>autopilot/ms-205[1]/mode/vertical-mode</property>
                        <value>3</value>
                    </equals>
                    <equals>
                        <property>autopilot/ms-205[1]/mode/vertical-arm</property>
                        <value>3</value>
                    </equals>
                </or>
            </condition>
            <property>autopilot/ms-205[1]/target/path-deg-error</property>
            <min>
                <expression>
                    <dif>
                        <value>-20</value>
                        <property>autopilot/source/airdata/pitch-deg</property>
                    </dif>
                </expression>
            </min>
            <max>
                <expression>
                    <dif>
                        <value>20</value>
                        <property>autopilot/source/airdata/pitch-deg</property>
                    </dif>
                </expression>
            </max>
        </input>

<!-- pitch hold -->
        <input>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/vertical-mode</property>
                    <value>0</value>
                </equals>
            </condition>
            <expression>
                <dif>
                    <property>autopilot/ms-205[1]/target/pitch-deg</property>
                    <property>autopilot/source/airdata/pitch-deg</property>
                </dif>
            </expression>
            <min>
                <expression>
                    <dif>
                        <value>-20</value>
                        <property>autopilot/source/airdata/pitch-deg</property>
                    </dif>
                </expression>
            </min>
            <max>
                <expression>
                    <dif>
                        <value>20</value>
                        <property>autopilot/source/airdata/pitch-deg</property>
                    </dif>
                </expression>
            </max>
        </input>

<!-- altitude hold -->
        <input>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/vertical-mode</property>
                    <value>1</value>
                </equals>
            </condition>
            <expression>
                <product>
                    <sum>
                        <property>autopilot/ms-205[1]/target/altitude-ft-error</property>
                        <product>
                            <property>autopilot/source/airdata/vs-fpm</property>
                            <value>-0.3</value>
                        </product>
                    </sum>
                    <value>0.002</value>
                </product>
            </expression>
            <min>
                <expression>
                    <dif>
                        <property>autopilot/source/max-descent-deg</property>
                        <property>autopilot/source/airdata/path-deg</property>
                    </dif>
                </expression>
            </min>
            <max>
                <expression>
                    <dif>
                        <property>autopilot/source/max-climb-deg</property>
                        <property>autopilot/source/airdata/path-deg</property>
                    </dif>
                </expression>
            </max>
        </input>

<!-- vs hold -->
        <input>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/vertical-mode</property>
                    <value>4</value>
                </equals>
            </condition>
            <expression>
                <product>
                    <dif>
                        <property>autopilot/ms-205[1]/target/vs-fpm</property>
                        <property>autopilot/source/airdata/vs-fpm</property>
                    </dif>
                    <value>0.0005</value>
                </product>
            </expression>
            <min>
                <expression>
                    <dif>
                        <value>-20</value>
                        <property>autopilot/source/airdata/pitch-deg</property>
                    </dif>
                </expression>
            </min>
            <max>
                <expression>
                    <dif>
                        <value>20</value>
                        <property>autopilot/source/airdata/pitch-deg</property>
                    </dif>
                </expression>
            </max>
        </input>

<!-- ias hold -->
        <input>
            <condition>
                <equals>
                    <property>autopilot/ms-205[1]/mode/vertical-mode</property>
                    <value>5</value>
                </equals>
            </condition>
            <expression>
                <sum>
                    <product>
                        <dif>
                            <property>autopilot/ms-205[1]/target/speed-kt</property>
                            <property>autopilot/source/airdata/ias-kt</property>
                        </dif>
                        <value>-0.01</value>
                    </product>
                    <property>autopilot/ms-205[1]/gain/ias-error</property>
                </sum>
            </expression>
            <min>
                <expression>
                    <dif>
                        <value>-20</value>
                        <property>autopilot/source/airdata/pitch-deg</property>
                    </dif>
                </expression>
            </min>
            <max>
                <expression>
                    <dif>
                        <value>20</value>
                        <property>autopilot/source/airdata/pitch-deg</property>
                    </dif>
                </expression>
            </max>
        </input>

        <output>autopilot/ms-205[1]/command/pitch-rate-degps</output>
    </filter>

<!-- command sticks -->

    <filter>
        <name>command-stick-roll-raw</name>
        <type>gain</type>
        <gain>1</gain>
        <debug>false</debug>
        <input>
            <condition>
                <less-than>
                    <property>instrumentation/turn-indicator/indicated-turn-rate</property>
                    <value>0.1</value>
                </less-than>
                <greater-than>
                    <property>instrumentation/turn-indicator/indicated-turn-rate</property>
                    <value>-0.1</value>
                </greater-than>
            </condition>
            <expression>
                <product>
                    <property>autopilot/ms-205[1]/command/roll-deg</property>
                    <value>30.0</value>
                </product>
            </expression>
        </input>
        <input>
            <expression>
                <product>
                    <property>autopilot/ms-205[1]/command/roll-deg</property>
                    <div>
                        <property>instrumentation/attitude-indicator[1]/indicated-roll-deg</property>
                        <property>instrumentation/turn-indicator/indicated-turn-rate</property>
                    </div>
                </product>
            </expression>
        </input>
        <min>-40.0</min>
        <max> 40.0</max>
        <output>autopilot/ms-205[1]/command/roll-deg-stick-raw</output>
    </filter>

    <filter>
        <name>command-stick-roll</name>
        <type>moving-average</type>
        <samples>120</samples>
        <input>autopilot/ms-205[1]/command/roll-deg-stick-raw</input>
        <output>autopilot/ms-205[1]/command/roll-deg-stick</output>
    </filter>

    <filter>
        <name>command-stick-pitch</name>
        <type>moving-average</type>
        <samples>120</samples>
        <input>autopilot/ms-205[1]/command/pitch-rate-degps</input>
        <output>autopilot/ms-205[1]/command/pitch-deg-stick</output>
        <min>-20.0</min>
        <max> 20.0</max>
    </filter>

</PropertyList>
