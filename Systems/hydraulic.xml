<?xml version="1.0" encoding="utf-8" ?>
<PropertyList>

<!--
TODO:
  calculate quantity of hydraulic oil
  distribute the oil to activ actuators
  set speed for every actuator via the '*-rate' property
-->

<!-- firewall-shutoff -->

    <filter>
        <name>firewall-cutoff-left</name>
        <debug>false</debug>
        <type>gain</type>
        <enable>
            <property>systems/hydraulic/valves/firewall-shutoff[0]/serviceable</property>
        </enable>
        <input>controls/engines/engine[0]/fire-switch</input>
        <output>systems/hydraulic/valves/firewall-shutoff[0]/state</output>
    </filter>

    <filter>
        <name>firewall-cutoff-right</name>
        <debug>false</debug>
        <type>gain</type>
        <enable>
            <property>systems/hydraulic/valves/firewall-shutoff[1]/serviceable</property>
        </enable>
        <input>controls/engines/engine[1]/fire-switch</input>
        <output>systems/hydraulic/valves/firewall-shutoff[1]/state</output>
    </filter>

<!-- pressure-psi -->

    <filter>
        <name>pressure-psi</name>
        <debug>false</debug>
        <type>gain</type>
        <input>
            <condition>
                <and>
                    <greater-than>
                        <property>systems/hydraulic/supplier/pump[0]/pressure-psi</property>
                        <property>systems/hydraulic/supplier/pump[1]/pressure-psi</property>
                    </greater-than>
                </and>
            </condition>
            <property>systems/hydraulic/supplier/pump[0]/pressure-psi</property>
        </input>
        <input>
            <condition>
                <and>
                    <greater-than>
                        <property>systems/hydraulic/supplier/pump[1]/pressure-psi</property>
                        <property>systems/hydraulic/supplier/pump[0]/pressure-psi</property>
                    </greater-than>
                </and>
            </condition>
            <property>systems/hydraulic/supplier/pump[1]/pressure-psi</property>
        </input>
        <input>
            <property>systems/hydraulic/supplier/pump[0]/pressure-psi</property>
        </input>
        <output>systems/hydraulic/supplier/pressure-psi</output>
    </filter>

<!-- quantity-gpm -->

    <filter>
        <name>quantity-gpm</name>
        <debug>false</debug>
        <type>gain</type>
        <input>
            <expression>
                <sum>
                    <property>systems/hydraulic/supplier/pump[0]/quantity-gpm</property>
                    <property>systems/hydraulic/supplier/pump[1]/quantity-gpm</property>
                </sum>
            </expression>
        </input>
        <output>systems/hydraulic/supplier/quantity-gpm</output>
    </filter>

<!-- gear valve -->

    <filter>
        <name>gear-valve</name>
        <debug>false</debug>
        <type>gain</type>
        <input>
            <condition>
                <and>
                    <property>systems/hydraulic/valves/gear/serviceable</property>
                    <greater-than>
                        <property>systems/electrical/outputs/main-left/sys-gear-ctrl</property>
                        <value>18</value>
                    </greater-than>
                    <not><property>controls/gear/emer-gear-cmd</property></not>
                    <or>
                        <not-equals>
                            <property>gear/gear[0]/position-norm-filtered</property>
                            <property>controls/gear/gear-down</property>
                        </not-equals>
                        <not-equals>
                            <property>gear/gear[1]/position-norm</property>
                            <property>controls/gear/gear-down</property>
                        </not-equals>
                        <not-equals>
                            <property>gear/gear[2]/position-norm</property>
                            <property>controls/gear/gear-down</property>
                        </not-equals>
                    </or>
                </and>
            </condition>
            <value>1</value>
        </input>
        <input>0</input>
        <output>systems/hydraulic/valves/gear/state</output>
    </filter>

<!-- speedbrake valve -->

    <filter>
        <name>speedbrake-valve</name>
        <debug>false</debug>
        <type>gain</type>
        <input>
            <condition>
                <property>systems/hydraulic/valves/speedbrakes/serviceable</property>
                <greater-than>
                    <property>systems/electrical/outputs/main-left/sys-speed-brake</property>
                    <value>18</value>
                </greater-than>
                <property>controls/flight/speedbrake-switch</property>
                <less-than>
                    <property>surface-positions/speedbrake-pos</property>
                    <value>1.0</value>
                </less-than>
            </condition>
            <value>1</value>
        </input>

        <input>
            <condition>
                <property>systems/hydraulic/valves/speedbrakes/serviceable</property>
                <greater-than>
                    <property>systems/electrical/outputs/main-left/sys-speed-brake</property>
                    <value>18</value>
                </greater-than>
                <not><property>controls/flight/speedbrake-switch</property></not>
                <greater-than>
                    <property>surface-positions/speedbrake-pos</property>
                    <value>0.0</value>
                </greater-than>
            </condition>
            <value>-1</value>
        </input>

        <input>0</input>
        <output>systems/hydraulic/valves/speedbrakes/state</output>
    </filter>

<!-- reverser valve -->

    <filter>
        <name>reverser-left-valve</name>
        <debug>false</debug>
        <type>gain</type>
        <input>
            <condition>
                <and>
                    <equals>
                        <property>sim/model/variant</property>
                        <value>0</value>
                    </equals>
                    <property>systems/hydraulic/valves/reverser-left/serviceable</property>
                    <greater-than>
                        <property>systems/electrical/outputs/main-left/sys-thrustrev-left</property>
                        <value>18</value>
                    </greater-than>
                    <or>
                        <property>controls/engines/engine[0]/reverser</property>
                        <property>controls/engines/engine[0]/reverser-emer-sw</property>
                        <and>
                            <not-equals>
                                <property>surface-positions/reverser-norm[0]</property>
                                <value>0</value>
                            </not-equals>
                        </and>
                    </or>
                </and>
            </condition>
            <value>1</value>
        </input>
        <input>0</input>
        <output>systems/hydraulic/valves/reverser-left/state</output>
    </filter>

    <filter>
        <name>reverser-right-valve</name>
        <debug>false</debug>
        <type>gain</type>
        <input>
            <condition>
                <and>
                    <equals>
                        <property>sim/model/variant</property>
                        <value>0</value>
                    </equals>
                    <property>systems/hydraulic/valves/reverser-right/serviceable</property>
                    <greater-than>
                        <property>systems/electrical/outputs/main-right-xover/sys-thrustrev-right</property>
                        <value>18</value>
                    </greater-than>
                    <or>
                        <property>controls/engines/engine[1]/reverser</property>
                        <property>controls/engines/engine[1]/reverser-emer-sw</property>
                        <and>
                            <not-equals>
                                <property>surface-positions/reverser-norm[1]</property>
                                <value>0</value>
                            </not-equals>
                        </and>
                    </or>
                </and>
            </condition>
            <value>1</value>
        </input>
        <input>0</input>
        <output>systems/hydraulic/valves/reverser-right/state</output>
    </filter>

<!-- center valve -->

    <filter>
        <name>hydraulic-center-valve</name>
        <debug>false</debug>
        <type>gain</type>
        <input>
            <condition>
                <and>
                    <property>systems/hydraulic/valves/center/serviceable</property>
                    <or>
                        <property>systems/hydraulic/valves/gear/state</property>
                        <property>systems/hydraulic/valves/speedbrakes/state</property>
                        <property>systems/hydraulic/valves/reverser-left/state</property>
                        <property>systems/hydraulic/valves/reverser-right/state</property>
                    </or>
                </and>
            </condition>
            <value>1</value>
        </input>
        <input>0</input>
        <output>systems/hydraulic/valves/center/state</output>
    </filter>

<!-- speedbrake -->

    <filter>
        <name>speedbrake-rate</name>
        <debug>false</debug>
        <type>gain</type>
        <input>
            <condition>
                <property>systems/hydraulic/valves/center/state</property>
                <property>systems/hydraulic/valves/speedbrakes/state</property>
                <property>systems/hydraulic/supplier/quantity-gpm</property>
            </condition>
            <value>1</value>
        </input>
        <input>0.0</input>
        <output>surface-positions/speedbrake-moving-rate</output>
    </filter>

    <filter>
        <name>speedbrake-pos</name>
        <debug>false</debug>
        <type>noise-spike</type>
        <max-rate-of-change>surface-positions/speedbrake-moving-rate</max-rate-of-change>
        <input>
            <condition>
                <property>systems/hydraulic/valves/speedbrakes/state</property>
            </condition>
            <property>controls/flight/speedbrake-switch</property>
        </input>
        <input>surface-positions/speedbrake-pos</input>
        <output>surface-positions/speedbrake-pos</output>
    </filter>

<!-- reverser -->

    <filter>
        <name>reverser-left-rate</name>
        <debug>false</debug>
        <type>gain</type>
        <input>
            <condition>
                <property>systems/hydraulic/valves/reverser-left/state</property>
                <property>systems/hydraulic/supplier/quantity-gpm</property>
            </condition>
            <value>0.65</value>
        </input>
        <input>0.0</input>
        <output>surface-positions/reverser-moving-rate[0]</output>
    </filter>

    <filter>
        <name>reverser-right-rate</name>
        <debug>false</debug>
        <type>gain</type>
        <input>
            <condition>
                <property>systems/hydraulic/valves/reverser-right/state</property>
                <property>systems/hydraulic/supplier/quantity-gpm</property>
            </condition>
            <value>0.65</value>
        </input>
        <input>0.0</input>
        <output>surface-positions/reverser-moving-rate[1]</output>
    </filter>

    <filter>
        <name>reverser-left-pos</name>
        <debug>false</debug>
        <type>noise-spike</type>
        <max-rate-of-change>surface-positions/reverser-moving-rate[0]</max-rate-of-change>
        <input>
            <condition>
                <property>systems/hydraulic/valves/reverser-left/state</property>
                <not><property>controls/engines/engine[0]/reverser-emer-sw</property></not>
            </condition>
            <property>controls/engines/engine[0]/reverser</property>
        </input>
        <input>
            <condition>
                <property>systems/hydraulic/valves/reverser-left/state</property>
                <property>controls/engines/engine[0]/reverser-emer-sw</property>
            </condition>
            <value>0.0</value>
        </input>
        <input>surface-positions/reverser-norm[0]</input>
        <output>surface-positions/reverser-norm[0]</output>
    </filter>

    <filter>
        <name>reverser-left-pos-jsb</name>
        <debug>false</debug>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>jsb</value>
                </equals>
            </condition>
        </enable>
        <input>
        <expression>
            <product>
                <property>surface-positions/reverser-norm[0]</property>
                <value>2.45</value>
            </product>
        </expression>
        </input>
        <output>fdm/jsbsim/propulsion/engine[0]/reverser-angle-rad</output>
    </filter>

    <filter>
        <name>reverser-right-pos</name>
        <debug>false</debug>
        <type>noise-spike</type>
        <max-rate-of-change>surface-positions/reverser-moving-rate[1]</max-rate-of-change>
        <input>
            <condition>
                <property>systems/hydraulic/valves/reverser-right/state</property>
                <not><property>controls/engines/engine[1]/reverser-emer-sw</property></not>
            </condition>
            <property>controls/engines/engine[1]/reverser</property>
        </input>
        <input>
            <condition>
                <property>systems/hydraulic/valves/reverser-right/state</property>
                <property>controls/engines/engine[1]/reverser-emer-sw</property>
            </condition>
            <value>0.0</value>
        </input>
        <input>surface-positions/reverser-norm[1]</input>
        <output>surface-positions/reverser-norm[1]</output>
    </filter>

    <filter>
        <name>reverser-right-pos-jsb</name>
        <debug>false</debug>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>jsb</value>
                </equals>
            </condition>
        </enable>
        <input>
        <expression>
            <product>
                <property>surface-positions/reverser-norm[1]</property>
                <value>2.45</value>
            </product>
        </expression>
        </input>
        <output>fdm/jsbsim/propulsion/engine[1]/reverser-angle-rad</output>
    </filter>

<!-- gears -->

    <filter>
        <name>nose-gear-rate</name>
        <debug>false</debug>
        <type>gain</type>
        <input>
            <condition>
                <property>controls/gear/blow-down</property>
            </condition>
            <value>0.20</value>
        </input>
        <input>
            <condition>
                <equals>
                    <property>controls/gear/emer-gear-pos</property>
                    <value>1.0</value>
                </equals>
            </condition>
            <value>0.15</value>
        </input>
        <input>
            <condition>
                <property>systems/hydraulic/valves/gear/state</property>
                <property>systems/hydraulic/supplier/quantity-gpm</property>
            </condition>
            <value>0.15</value>
        </input>
        <output>gear/gear[0]/moving-rate</output>
    </filter>

    <filter>
        <name>left-gear-rate</name>
        <debug>false</debug>
        <type>gain</type>
        <input>
            <condition>
                <property>controls/gear/blow-down</property>
            </condition>
            <value>0.20</value>
        </input>
        <input>
            <condition>
                <equals>
                    <property>controls/gear/emer-gear-pos</property>
                    <value>1.0</value>
                </equals>
            </condition>
            <value>0.15</value>
        </input>
        <input>
            <condition>
                <property>systems/hydraulic/valves/gear/state</property>
                <property>systems/hydraulic/supplier/quantity-gpm</property>
            </condition>
            <value>0.15</value>
        </input>
        <output>gear/gear[1]/moving-rate</output>
    </filter>

    <filter>
        <name>right-gear-rate</name>
        <debug>false</debug>
        <type>gain</type>
        <input>
            <condition>
                <property>controls/gear/blow-down</property>
            </condition>
            <value>0.20</value>
        </input>
        <input>
            <condition>
                <equals>
                    <property>controls/gear/emer-gear-pos</property>
                    <value>1.0</value>
                </equals>
            </condition>
            <value>0.15</value>
        </input>
        <input>
            <condition>
                <property>systems/hydraulic/valves/gear/state</property>
                <property>systems/hydraulic/supplier/quantity-gpm</property>
            </condition>
            <value>0.15</value>
        </input>
        <output>gear/gear[2]/moving-rate</output>
    </filter>

    <filter>
        <name>normal-nose-gear-position</name>
        <debug>false</debug>
        <type>noise-spike</type>
        <max-rate-of-change>gear/gear[0]/moving-rate</max-rate-of-change>
        <enable>
            <condition>
                <not><property>sim/model/pushback/enabled</property></not>
                <less-than>
                    <property>sim/model/pushback/visible</property>
                    <value>0.1</value>
                </less-than>
            </condition>
        </enable>
        <input>
            <condition>
                <property>controls/gear/blow-down</property>
            </condition>
            <value>1.0</value>
        </input>
        <input>
            <condition>
                <equals>
                    <property>controls/gear/emer-gear-pos</property>
                    <value>1.0</value>
                </equals>
            </condition>
            <value>0.95</value>
        </input>
        <input>
            <condition>
                <property>systems/hydraulic/valves/gear/state</property>
            </condition>
            <property>controls/gear/gear-down</property>
        </input>
        <input>gear/gear[0]/position-norm</input>
        <output>gear/gear[0]/position-norm</output>
    </filter>

    <filter>
        <name>pushback-nose-gear</name>
        <debug>false</debug>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>yasim</value>
                </equals>
                <property>sim/model/pushback/enabled</property>
            </condition>
        </enable>
        <input>
            <condition>
                <property>sim/model/pushback/linked</property>
            </condition>
            <value>0</value>
        </input>
        <input>1</input>
        <output>gear/gear[0]/position-norm</output>
    </filter>

    <filter>
        <name>pushback-fake-gear-position</name>
        <debug>false</debug>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>yasim</value>
                </equals>
                <property>sim/model/pushback/enabled</property>
            </condition>
        </enable>
        <input>
            <condition>
                <property>sim/model/pushback/linked</property>
            </condition>
            <value>1</value>
        </input>
        <input>0</input>
        <output>gear/gear[3]/position-norm</output>
    </filter>

    <filter>
        <name>nose-gear-position</name>
        <debug>false</debug>
        <type>gain</type>
        <input>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>yasim</value>
                </equals>
                <property>sim/model/pushback/linked</property>
            </condition>
            <property>gear/gear[3]/position-norm</property>
        </input>
        <input>gear/gear[0]/position-norm</input>
        <output>gear/gear[0]/position-norm-filtered</output>
    </filter>

    <filter>
        <name>nose-gear-caster</name>
        <debug>false</debug>
        <type>gain</type>
        <input>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>jsb</value>
                </equals>
                <property>sim/model/pushback/linked</property>
            </condition>
            <property>sim/model/pushback/aircraft/steering</property>
            <scale>60.0</scale>
        </input>
        <input>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>jsb</value>
                </equals>
            </condition>
            <property>gear/gear[0]/steering-norm</property>
            <scale>60.0</scale>
        </input>
        <input>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>yasim</value>
                </equals>
                <property>sim/model/pushback/linked</property>
            </condition>
            <property>gear/gear[3]/caster-angle-deg</property>
        </input>
        <input>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>yasim</value>
                </equals>
            </condition>
            <property>gear/gear[0]/caster-angle-deg</property>
        </input>
        <output>gear/gear[0]/caster-angle-deg-filtered</output>
    </filter>

    <filter>
        <name>nose-gear-rollspeed</name>
        <debug>false</debug>
        <type>gain</type>
        <input>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>yasim</value>
                </equals>
                <property>sim/model/pushback/linked</property>
            </condition>
            <property>gear/gear[3]/rollspeed-ms</property>
        </input>
        <input>gear/gear[0]/rollspeed-ms</input>
        <output>gear/gear[0]/rollspeed-ms-filtered</output>
    </filter>

    <filter>
        <name>nose-gear-compression</name>
        <debug>false</debug>
        <type>gain</type>
        <input>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>yasim</value>
                </equals>
                <property>sim/model/pushback/linked</property>
            </condition>
            <property>gear/gear[3]/compression-m</property>
        </input>
        <input>gear/gear[0]/compression-m</input>
        <output>gear/gear[0]/compression-m-filtered</output>
    </filter>

    <filter>
        <name>nose-gear-compression-m</name>
        <debug>false</debug>
        <type>gain</type>
        <input>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>yasim</value>
                </equals>
                <property>sim/model/pushback/linked</property>
            </condition>
            <property>gear/gear[3]/compression-m</property>
        </input>
        <input>gear/gear[0]/compression-m</input>
        <output>gear/gear[0]/compression-m-filtered</output>
    </filter>

    <filter>
        <name>left-main-gear-position</name>
        <debug>false</debug>
        <type>noise-spike</type>
        <max-rate-of-change>gear/gear[1]/moving-rate</max-rate-of-change>
        <input>
            <condition>
                <property>controls/gear/blow-down</property>
            </condition>
            <value>1.0</value>
        </input>
        <input>
            <condition>
                <equals>
                    <property>controls/gear/emer-gear-pos</property>
                    <value>1.0</value>
                </equals>
            </condition>
            <value>0.95</value>
        </input>
        <input>
            <condition>
                <property>systems/hydraulic/valves/gear/state</property>
            </condition>
            <property>controls/gear/gear-down</property>
        </input>
        <input>gear/gear[1]/position-norm</input>
        <output>gear/gear[1]/position-norm</output>
    </filter>

    <filter>
        <name>right-main-gear-position</name>
        <debug>false</debug>
        <type>noise-spike</type>
        <max-rate-of-change>gear/gear[2]/moving-rate</max-rate-of-change>
        <input>
            <condition>
                <property>controls/gear/blow-down</property>
            </condition>
            <value>1.0</value>
        </input>
        <input>
            <condition>
                <equals>
                    <property>controls/gear/emer-gear-pos</property>
                    <value>1.0</value>
                </equals>
            </condition>
            <value>0.95</value>
        </input>
        <input>
            <condition>
                <property>systems/hydraulic/valves/gear/state</property>
            </condition>
            <property>controls/gear/gear-down</property>
        </input>
        <input>gear/gear[2]/position-norm</input>
        <output>gear/gear[2]/position-norm</output>
    </filter>

    <logic>
        <input>
            <less-than>
                <property>gear/gear[0]/position-norm-filtered</property>
                <value>1.0</value>
            </less-than>
            <less-than>
                <property>gear/gear[1]/position-norm</property>
                <value>1.0</value>
            </less-than>
            <less-than>
                <property>gear/gear[2]/position-norm</property>
                <value>1.0</value>
            </less-than>
        </input>
        <output>instrumentation/mk-viii/inputs/discretes/landing-gear</output>
    </logic>

    <filter>
        <name>jsbsim-normal-nose-gear-position</name>
        <debug>false</debug>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>jsb</value>
                </equals>
            </condition>
        </enable>
        <input>gear/gear[0]/position-norm-filtered</input>
        <output>fdm/jsbsim/gear/unit[0]/pos-norm</output>
    </filter>

    <filter>
        <name>jsbsim-left-main-gear-position</name>
        <debug>false</debug>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>jsb</value>
                </equals>
            </condition>
        </enable>
        <input>gear/gear[1]/position-norm</input>
        <output>fdm/jsbsim/gear/unit[1]/pos-norm</output>
    </filter>

    <filter>
        <name>jsbsim-right-main-gear-position</name>
        <debug>false</debug>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>jsb</value>
                </equals>
            </condition>
        </enable>
        <input>gear/gear[2]/position-norm</input>
        <output>fdm/jsbsim/gear/unit[2]/pos-norm</output>
    </filter>

    <filter>
        <name>jsbsim-gear-position</name>
        <debug>false</debug>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>jsb</value>
                </equals>
            </condition>
        </enable>
        <input>
            <condition>
                <or>
                    <less-than>
                        <property>gear/gear[0]/position-norm-filtered</property>
                        <value>1.0</value>
                    </less-than>
                    <less-than>
                        <property>gear/gear[1]/position-norm</property>
                        <value>1.0</value>
                    </less-than>
                    <less-than>
                        <property>gear/gear[2]/position-norm</property>
                        <value>1.0</value>
                    </less-than>
                </or>
            </condition>
            <value>0</value>
        </input>
        <input>1</input>
        <output>fdm/jsbsim/gear/gear-pos-norm</output>
    </filter>

    <filter>
        <name>clear-maintenance</name>
        <debug>false</debug>
        <type>gain</type>
        <enable>
            <condition>
                <property>controls/gear/blow-down</property>
                <equals>
                    <property>controls/gear/gear-lever-pos</property>
                    <value>1</value>
                </equals>
                <equals>
                    <property>controls/gear/emer-gear-pos</property>
                    <value>0</value>
                </equals>
            </condition>
        </enable>
        <input>0</input>
        <output>controls/gear/blow-down</output>
    </filter>

</PropertyList>
