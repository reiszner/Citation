<?xml version="1.0" encoding="utf-8" ?>

<PropertyList>

  <!-- Suppliers are defined in Citation-II-common.xml -->

  <filter>
    <type>gain</type>
    <input>
      <property>systems/electrical/outputs/main-left-xover/dc-dg1</property>
    </input>
    <output>
      <property>systems/electrical/outputs/DG[0]</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <property>systems/electrical/outputs/emer/dc-dg2</property>
    </input>
    <output>
      <property>systems/electrical/outputs/DG[1]</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <property>systems/electrical/outputs/main-right/dc-gpws</property>
    </input>
    <output>
      <property>systems/electrical/outputs/mk-viii[0]</property>
    </output>
  </filter>
<!--
##################
####  LIGHTS  ####
##################
  -->

  <!-- circumvent odd nasal program which controls beacon operation -->
  <filter>
    <type>gain</type>
    <input>
      <condition>
        <and>
          <property>systems/electrical/outputs/main-left/light-beacon</property>
          <property>controls/lighting/beacon-switch</property>
        </and>
      </condition>
      <value>1</value>
    </input>
    <input>0</input>
    <output>
      <property>controls/lighting/beacon</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
        <and>
          <property>controls/lighting/landing-light-switch</property>
          <property>systems/electrical/outputs/main-left/light-landing-left</property>
        </and>
      </condition>
      <value>1</value>
    </input>
    <input>
      <value>0</value>
    </input>
    <output>
      <property>controls/lighting/landing-light</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
        <and>
          <property>controls/lighting/landing-light-switch[1]</property>
          <property>systems/electrical/outputs/main-right/light-landing-right</property>
        </and>
      </condition>
      <value>1</value>
    </input>
    <output>
      <property>controls/lighting/landing-light[1]</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
        <and>
          <property>controls/lighting/strobe-switch</property>
          <property>systems/electrical/outputs/main-left/light-strobe</property>
        </and>
      </condition>
      <value>1</value>
    </input>
    <output>
      <property>controls/lighting/strobe</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
        <and>
          <property>controls/lighting/nav-lights-switch</property>
          <property>systems/electrical/outputs/main-left/light-nav</property>
        </and>
      </condition>
      <value>1</value>
    </input>
    <output>
      <property>controls/lighting/nav-lights</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
        <and>
          <property>controls/lighting/recog-lights-switch</property>
          <property>systems/electrical/outputs/main-left/light-recog-left</property>
        </and>
      </condition>
      <value>1</value>
    </input>
    <output>
      <property>controls/lighting/recog-light[0]</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
        <and>
          <property>controls/lighting/recog-lights-switch</property>
          <property>systems/electrical/outputs/main-right/light-recog-right</property>
        </and>
      </condition>
      <value>1</value>
    </input>
    <output>
      <property>controls/lighting/recog-light[1]</property>
    </output>
  </filter>

<!--
##########################
####  Electric panel  ####
##########################
  -->

  <filter>
    <type>exponential</type>
    <filter-time>0.5</filter-time>
    <input>
      <condition>
        <equals>
          <property>controls/electric/voltage-sel</property>
          <value>0</value>
        </equals>
      </condition>
      <property>systems/electrical/outputs/battery/batt-voltage</property>
    </input>
    <input>
      <condition>
        <equals>
          <property>controls/electric/voltage-sel</property>
          <value>-1</value>
        </equals>
      </condition>
      <property>systems/electrical/outputs/isolated-left/gen-voltage-left</property>
    </input>
    <input>
      <condition>
        <equals>
          <property>controls/electric/voltage-sel</property>
          <value>1</value>
        </equals>
      </condition>
      <property>systems/electrical/outputs/isolated-right/gen-voltage-right</property>
    </input>
    <output>
      <property>controls/electric/voltage-display</property>
    </output>
    <min>10</min>
    <max>40</max>
  </filter>

  <filter>
    <type>exponential</type>
    <filter-time>0.5</filter-time>
    <input>
      <property>systems/electrical/supplier/generator[0]/load</property>
    </input>
    <output>
      <property>controls/electric/amp-left-display</property>
    </output>
    <min>0</min>
    <max>400</max>
  </filter>

  <filter>
    <type>exponential</type>
    <filter-time>0.5</filter-time>
    <input>
      <property>systems/electrical/supplier/generator[1]/load</property>
    </input>
    <output>
      <property>controls/electric/amp-right-display</property>
    </output>
    <min>0</min>
    <max>400</max>
  </filter>

<!--
##### GCU (Generator Control Unit) #####
-->

<!-- starter button logic -->

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <or>
                    <not><property>systems/electrical/outputs/main-left/left-starter</property></not>
                    <property>controls/electric/engine[0]/generator-ready</property>
                    <greater-than>
                        <property>sim/time/elapsed-sec</property>
                        <expression>
                            <sum>
                                <property>controls/electric/engine[0]/starter-btn</property>
                                <value>30.0</value>
                            </sum>
                        </expression>
                    </greater-than>
                </or>
            </condition>
        </enable>
        <input>0</input>
        <output>controls/electric/engine[0]/starter-btn</output>
    </filter>

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <or>
                    <not><property>systems/electrical/outputs/main-right/right-starter</property></not>
                    <property>controls/electric/engine[1]/generator-ready</property>
                    <greater-than>
                        <property>sim/time/elapsed-sec</property>
                        <expression>
                            <sum>
                                <property>controls/electric/engine[1]/starter-btn</property>
                                <value>30.0</value>
                            </sum>
                        </expression>
                    </greater-than>
                </or>
            </condition>
        </enable>
        <input>0</input>
        <output>controls/electric/engine[1]/starter-btn</output>
    </filter>

<!-- starter and fuel-boost control -->

    <filter>
        <type>gain</type>
        <input>
            <condition>
                <property>controls/electric/engine[0]/starter-btn</property>
            </condition>
            <value>1</value>
        </input>
        <input>0</input>
        <output>controls/electric/engine[0]/starter</output>
        <output>controls/fuel/tank[0]/boost-pump-automatic</output>
    </filter>

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>jsb</value>
                </equals>
            </condition>
        </enable>
        <input>
            <condition>
                <or>
                    <property>controls/electric/engine[0]/starter</property>
                    <and>
                        <property>controls/engines/engine[0]/starter</property>
                        <not><property>engines/engine[0]/running</property></not>
                    </and>
                </or>
            </condition>
            <value>1</value>
        </input>
        <input>
            <value>0</value>
        </input>
        <output>controls/engines/engine[0]/starter</output>
    </filter>

    <filter>
        <type>gain</type>
        <input>
            <condition>
                <property>controls/electric/engine[1]/starter-btn</property>
            </condition>
            <value>1</value>
        </input>
        <input>0</input>
        <output>controls/electric/engine[1]/starter</output>
        <output>controls/fuel/tank[1]/boost-pump-automatic</output>
    </filter>

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>jsb</value>
                </equals>
            </condition>
        </enable>
        <input>
            <condition>
                <or>
                    <property>controls/electric/engine[1]/starter</property>
                    <and>
                        <property>controls/engines/engine[1]/starter</property>
                        <not><property>engines/engine[1]/running</property></not>
                    </and>
                </or>
            </condition>
            <value>1</value>
        </input>
        <input>
            <value>0</value>
        </input>
        <output>controls/engines/engine[1]/starter</output>
    </filter>

<!-- ignition control -->

    <filter>
        <type>gain</type>
        <input>
            <condition>
                <property>controls/electric/engine[0]/starter</property>
            </condition>
            <value>1</value>
        </input>
        <input>0</input>
        <output>controls/engines/engine[0]/ignition-auto</output>
    </filter>

    <filter>
        <type>gain</type>
        <input>
            <condition>
                <property>controls/electric/engine[1]/starter</property>
            </condition>
            <value>1</value>
        </input>
        <input>0</input>
        <output>controls/engines/engine[1]/ignition-auto</output>
    </filter>

<!-- engine check -->

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <property>controls/engines/engine[0]/ignition</property>
                <not><property>controls/engines/engine[0]/cutoff</property></not>
                <property>controls/fuel/tank[0]/boost-pump</property>
                <or>
                    <and>
                        <property>controls/electric/engine[0]/starter</property>
                        <greater-than>
                            <property>engines/engine[0]/turbine</property>
                            <value>8</value>
                        </greater-than>
                    </and>
                    <greater-than>
                        <property>velocities/equivalent-kt</property>
                        <value>200</value>
                    </greater-than>
                </or>
            </condition>
        </enable>
        <input>1</input>
        <output>controls/engines/engine[0]/combusting</output>
    </filter>

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <property>controls/engines/engine[0]/combusting</property>
                <greater-than>
                    <property>engines/engine[0]/turbine</property>
                    <value>40</value>
                </greater-than>
                <or>
                    <property>controls/electric/engine[0]/starter</property>
                    <and>
                        <property>engines/engine[0]/started</property>
                        <equals>
                            <property>controls/electric/engine[0]/generator-sw</property>
                            <value>-1</value>
                        </equals>
                    </and>
                </or>
            </condition>
        </enable>
        <input>1</input>
        <output>controls/electric/engine[0]/generator-ready</output>
    </filter>

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>yasim</value>
                </equals>
                <not><property>engines/engine[0]/started</property></not>
                <property>controls/engines/engine[0]/combusting</property>
                <greater-than>
                    <expression>
                        <sum>
                            <property>engines/engine[0]/turbine</property>
                            <value>0.5</value>
                        </sum>
                    </expression>
                    <property>engines/engine[0]/n2</property>
                </greater-than>
            </condition>
        </enable>
        <input>1</input>
        <output>engines/engine[0]/started</output>
    </filter>

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>jsb</value>
                </equals>
                <property>engines/engine[0]/running</property>
            </condition>
        </enable>
        <input>1</input>
        <output>engines/engine[0]/started</output>
    </filter>

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <property>engines/engine[0]/started</property>
                <or>
                    <property>controls/engines/engine[0]/cutoff</property>
                    <not><property>controls/engines/engine[0]/combusting</property></not>
                    <and>
                        <less-than-equals>
                            <property>controls/electric/fuel-sel</property>
                            <value>0</value>
                        </less-than-equals>
                        <property>consumables/fuel/tank[0]/empty</property>
                    </and>
                    <and>
                        <greater-than>
                            <property>controls/electric/fuel-sel</property>
                            <value>0</value>
                        </greater-than>
                        <property>consumables/fuel/tank[1]/empty</property>
                    </and>
                </or>
            </condition>
        </enable>
        <input>0</input>
        <output>controls/engines/engine[0]/combusting</output>
        <output>controls/electric/engine[0]/generator-ready</output>
        <output>engines/engine[0]/started</output>
    </filter>

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <property>controls/engines/engine[1]/ignition</property>
                <not><property>controls/engines/engine[1]/cutoff</property></not>
                <property>controls/fuel/tank[1]/boost-pump</property>
                <or>
                    <and>
                        <property>controls/electric/engine[1]/starter</property>
                        <greater-than>
                            <property>engines/engine[1]/turbine</property>
                            <value>8</value>
                        </greater-than>
                    </and>
                    <greater-than>
                        <property>velocities/equivalent-kt</property>
                        <value>200</value>
                    </greater-than>
                </or>
            </condition>
        </enable>
        <input>1</input>
        <output>controls/engines/engine[1]/combusting</output>
    </filter>

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <property>controls/engines/engine[1]/combusting</property>
                <greater-than>
                    <property>engines/engine[1]/turbine</property>
                    <value>40</value>
                </greater-than>
                <or>
                    <property>controls/electric/engine[1]/starter</property>
                    <and>
                        <property>engines/engine[1]/started</property>
                        <equals>
                            <property>controls/electric/engine[1]/generator-sw</property>
                            <value>-1</value>
                        </equals>
                    </and>
                </or>
            </condition>
        </enable>
        <input>1</input>
        <output>controls/electric/engine[1]/generator-ready</output>
    </filter>

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>yasim</value>
                </equals>
                <not><property>engines/engine[1]/started</property></not>
                <property>controls/engines/engine[1]/combusting</property>
                <greater-than>
                    <expression>
                        <sum>
                            <property>engines/engine[1]/turbine</property>
                            <value>0.5</value>
                        </sum>
                    </expression>
                    <property>engines/engine[1]/n2</property>
                </greater-than>
            </condition>
        </enable>
        <input>1</input>
        <output>engines/engine[1]/started</output>
    </filter>

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>jsb</value>
                </equals>
                <property>engines/engine[1]/running</property>
            </condition>
        </enable>
        <input>1</input>
        <output>engines/engine[1]/started</output>
    </filter>

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <property>engines/engine[1]/started</property>
                <or>
                    <property>controls/engines/engine[1]/cutoff</property>
                    <not><property>controls/engines/engine[1]/combusting</property></not>
                    <and>
                        <less-than>
                            <property>controls/electric/fuel-sel</property>
                            <value>0</value>
                        </less-than>
                        <property>consumables/fuel/tank[0]/empty</property>
                    </and>
                    <and>
                        <greater-than-equals>
                            <property>controls/electric/fuel-sel</property>
                            <value>0</value>
                        </greater-than-equals>
                        <property>consumables/fuel/tank[1]/empty</property>
                    </and>
                </or>
            </condition>
        </enable>
        <input>0</input>
        <output>controls/engines/engine[1]/combusting</output>
        <output>controls/electric/engine[1]/generator-ready</output>
        <output>engines/engine[1]/started</output>
    </filter>

<!-- spool speed -->

    <filter>
        <type>gain</type>
        <input>
            <condition>
                <property>engines/engine[0]/started</property>
            </condition>
            <value>0.2</value>
        </input>
        <input>
            <condition>
                <or>
                    <property>controls/electric/engine[0]/starter</property>
                    <property>controls/engines/engine[0]/combusting</property>
                </or>
            </condition>
            <expression>
                <div>
                    <dif>
                        <property>engines/engine[0]/n2</property>
                        <property>engines/engine[0]/turbine</property>
                    </dif>
                    <value>3.0</value>
                </div>
            </expression>
            <min>0.2</min>
            <max>4.0</max>
        </input>
        <input>12.0</input>
        <output>controls/engines/engine[0]/spool-time</output>
    </filter>

    <filter>
        <type>gain</type>
        <input>
            <condition>
                <property>engines/engine[1]/started</property>
            </condition>
            <value>0.2</value>
        </input>
        <input>
            <condition>
                <or>
                    <property>controls/electric/engine[1]/starter</property>
                    <property>controls/engines/engine[1]/combusting</property>
                </or>
            </condition>
            <expression>
                <div>
                    <dif>
                        <property>engines/engine[1]/n2</property>
                        <property>engines/engine[1]/turbine</property>
                    </dif>
                    <value>3.0</value>
                </div>
            </expression>
            <min>0.2</min>
            <max>4.0</max>
        </input>
        <input>12.0</input>
        <output>controls/engines/engine[1]/spool-time</output>
    </filter>

<!-- turbine spool -->

    <filter>
        <type>exponential</type>
        <filter-time>controls/engines/engine[0]/spool-time</filter-time>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>yasim</value>
                </equals>
            </condition>
        </enable>
        <input>
            <condition>
                <not><property>controls/engines/engine[0]/combusting</property></not>
                <not><property>controls/electric/engine[0]/starter</property></not>
            </condition>
            <value>0.0</value>
        </input>
        <input>
            <condition>
                <not><property>controls/engines/engine[0]/combusting</property></not>
                <property>controls/electric/engine[0]/starter</property>
            </condition>
            <value>20.0</value>
        </input>
        <input>
            <condition>
                <property>controls/engines/engine[0]/combusting</property>
            </condition>
            <property>engines/engine[0]/n2</property>
        </input>
        <output>engines/engine[0]/turbine</output>
    </filter>

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>jsb</value>
                </equals>
            </condition>
        </enable>
        <input>engines/engine[0]/n2</input>
        <output>engines/engine[0]/turbine</output>
    </filter>

    <filter>
        <type>exponential</type>
        <filter-time>controls/engines/engine[1]/spool-time</filter-time>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>yasim</value>
                </equals>
            </condition>
        </enable>
        <input>
            <condition>
                <not><property>controls/engines/engine[1]/combusting</property></not>
                <not><property>controls/electric/engine[1]/starter</property></not>
            </condition>
            <value>0.0</value>
        </input>
        <input>
            <condition>
                <not><property>controls/engines/engine[1]/combusting</property></not>
                <property>controls/electric/engine[1]/starter</property>
            </condition>
            <value>20.0</value>
        </input>
        <input>
            <condition>
                <property>controls/engines/engine[1]/combusting</property>
            </condition>
            <property>engines/engine[1]/n2</property>
        </input>
        <output>engines/engine[1]/turbine</output>
    </filter>

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>jsb</value>
                </equals>
            </condition>
        </enable>
        <input>engines/engine[1]/n2</input>
        <output>engines/engine[1]/turbine</output>
    </filter>

<!-- fan spool -->

    <filter>
        <type>exponential</type>
        <filter-time>controls/engines/engine[0]/spool-time</filter-time>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>yasim</value>
                </equals>
            </condition>
        </enable>
        <input>
            <condition>
                <not><property>engines/engine[0]/started</property></not>
            </condition>
            <expression>
                <sum>
                    <product>
                        <property>engines/engine[0]/turbine</property>
                        <value>0.915</value>
                    </product>
                    <product>
                        <property>velocities/equivalent-kt</property>
                        <value>0.05</value>
                    </product>
                </sum>
            </expression>
        </input>
        <input>
            <condition>
                <property>engines/engine[0]/started</property>
            </condition>
            <property>engines/engine[0]/n1</property>
        </input>
        <output>engines/engine[0]/fan</output>
    </filter>

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>jsb</value>
                </equals>
            </condition>
        </enable>
        <input>engines/engine[0]/n1</input>
        <output>engines/engine[0]/fan</output>
    </filter>

    <filter>
        <type>exponential</type>
        <filter-time>controls/engines/engine[1]/spool-time</filter-time>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>yasim</value>
                </equals>
            </condition>
        </enable>
        <input>
            <condition>
                <not><property>engines/engine[1]/started</property></not>
            </condition>
            <expression>
                <sum>
                    <product>
                        <property>engines/engine[1]/turbine</property>
                        <value>0.915</value>
                    </product>
                    <product>
                        <property>velocities/equivalent-kt</property>
                        <value>0.05</value>
                    </product>
                </sum>
            </expression>
        </input>
        <input>
            <condition>
                <property>engines/engine[1]/started</property>
            </condition>
            <property>engines/engine[1]/n1</property>
        </input>
        <output>engines/engine[1]/fan</output>
    </filter>

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>jsb</value>
                </equals>
            </condition>
        </enable>
        <input>engines/engine[1]/n1</input>
        <output>engines/engine[1]/fan</output>
    </filter>

<!-- yasim throttle correction for idle thrust -->

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>yasim</value>
                </equals>
            </condition>
        </enable>
        <input>
            <condition>
                <not><property>controls/engines/engine[0]/combusting</property></not>
            </condition>
            <value>0.0</value>
        </input>
        <input>
            <condition>
                <property>controls/engines/engine[0]/combusting</property>
                <not><property>engines/engine[0]/started</property></not>
            </condition>
            <expression>
                <product>
                    <div>
                        <property>engines/engine[0]/turbine</property>
                        <value>49.0</value>
                    </div>
                    <value>0.105</value>
                </product>
            </expression>
        </input>
        <input>
            <expression>
                <sum>
                    <product>
                        <property>controls/engines/engine[0]/throttle-real</property>
                        <value>0.895</value>
                    </product>
                    <value>0.105</value>
                </sum>
            </expression>
        </input>
        <output>controls/engines/engine[0]/throttle-yasim</output>
    </filter>

    <filter>
        <type>gain</type>
        <enable>
            <condition>
                <equals>
                    <property>sim/flight-model</property>
                    <value>yasim</value>
                </equals>
            </condition>
        </enable>
        <input>
            <condition>
                <not><property>controls/engines/engine[1]/combusting</property></not>
            </condition>
            <value>0.0</value>
        </input>
        <input>
            <condition>
                <property>controls/engines/engine[1]/combusting</property>
                <not><property>engines/engine[1]/started</property></not>
            </condition>
            <expression>
                <product>
                    <div>
                        <property>engines/engine[1]/turbine</property>
                        <value>49.0</value>
                    </div>
                    <value>0.105</value>
                </product>
            </expression>
        </input>
        <input>
            <expression>
                <sum>
                    <product>
                        <property>controls/engines/engine[1]/throttle-real</property>
                        <value>0.895</value>
                    </product>
                    <value>0.105</value>
                </sum>
            </expression>
        </input>
        <output>controls/engines/engine[1]/throttle-yasim</output>
    </filter>

<!--
###########################
####  Flight Controls  ####
###########################
  -->

  <filter>
    <type>gain</type>
    <input>
      <condition>
        <greater-than>
          <property>gear/gear[1]/compression-norm</property>
          <value>0.01</value>
        </greater-than>
      </condition>
      <value>1</value>
    </input>
    <output>
      <property>controls/electric/maingear-switch</property>
    </output>
  </filter>

  <filter>
    <name>speedbrake-control</name>
    <type>gain</type>
    <enable>
      <condition>
        <property>controls/flight/speedbrake-switch</property>
        <or>
          <greater-than>
            <property>engines/engine[0]/turbine</property>
            <value>85</value>
          </greater-than>
          <greater-than>
            <property>engines/engine[1]/turbine</property>
            <value>85</value>
          </greater-than>
          <less-than>
            <property>systems/electrical/outputs/main-left/sys-speed-brake</property>
            <value>16</value>
          </less-than>
        </or>
      </condition>
    </enable>
    <input>0</input>
    <output>controls/flight/speedbrake-switch</output>
  </filter>

</PropertyList>
